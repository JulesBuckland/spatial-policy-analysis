REPLICATION PACKAGE: Left Behind - Energy Crisis & Health
=========================================================

This package contains the code and metadata necessary to replicate the analysis in:
"Left Behind: The Health Consequences of Failed Retrofit Delivery During the Energy Crisis"

**IMPORTANT: DATA DOWNLOAD REQUIRED**
To reduce package size, large raw datasets have been removed. You must download them from official sources before running the code.

FOLDER STRUCTURE
----------------
01_Data/
    Raw_Data/           : Place downloaded CSVs here (EPC, Lookup, Health, Deprivation).
    Processed_Data/     : Intermediate files generated by cleaning scripts.
    Spatial_Data/       : Place downloaded GeoPackage here.
    Metadata/           : Contains 'policy_eligibility.csv'.
02_Code/                : Python and R scripts.
03_Output_Logs/         : Outputs.

DATA DOWNLOAD INSTRUCTIONS
--------------------------
Please download the following files and place them in the specified directories.

1. Energy Performance Certificates (EPC)
   - **Source**: https://epc.opendatacommunities.org/domestic/search
   - **Action**: 
     1. Register and login.
     2. Select "Local Authority" search.
     3. Download data for: **Manchester**, **Salford**, **Stockport**, **Trafford**.
     4. Unzip each download.
     5. Rename the `certificates.csv` from each zip to match these names:
        - `domestic-Manchester.csv`
        - `domestic-Salford.csv`
        - `domestic-Stockport.csv`
        - `domestic-Trafford.csv`
     6. Move these 4 files to: `01_Data/Raw_Data/`

2. Geographic Lookup (NSPL)
   - **Source**: https://geoportal.statistics.gov.uk/
   - **Action**:
     1. Search for "National Statistics Postcode Lookup".
     2. Download the latest available version (e.g., "NSPL FEB 2025" or similar).
     3. Extract the main CSV file (usually in `Data/` folder of the zip, e.g., `NSPL_FEB_2025_UK.csv`).
     4. Rename it to: `lookup.csv`
     5. Move to: `01_Data/Raw_Data/`

3. Spatial Boundaries (MSOA 2021)
   - **Source**: https://geoportal.statistics.gov.uk/
   - **Action**:
     1. Search for: "Middle Layer Super Output Areas (December 2021) Boundaries EW BGC"
     2. Download the **GeoPackage** format (not Shapefile).
     3. Rename the file to: `msoa dec 2021 boundaries.gpkg`
     4. Move to: `01_Data/Spatial_Data/`

4. Included Data (Do not delete)
   - The following small datasets are already included in `01_Data/Raw_Data/`:
     - `deprivation.csv` (IMD 2019)
     - `health_*.csv` (NHS Hospital Admissions, MSOA cuts)
     - `Consumer prices...xlsx` (Energy Prices)
   - Metadata: `01_Data/Metadata/policy_eligibility.csv`

RUN ORDER
---------
Prerequisites: Python 3.x (pandas, statsmodels, linearmodels) and R (ggplot2, dplyr, tidyr).
Run all commands from the root of the 'Replication_Package' directory.

PHASE 1: DATA PREPARATION
1. python 02_Code/Figure_Generation/clean_energy_data.py
2. python 02_Code/Figure_Generation/prep_dep_data.py
3. python 02_Code/Figure_Generation/extract_polygons.py
   *Note: This step requires the MSOA GeoPackage and Lookup CSV.*
4. python 02_Code/Figure_Generation/extract_borough_outlines.py

PHASE 2: MODEL ANALYSIS
5. python 02_Code/Model_Analysis/did_analysis.py
   - Generates main results (Beta = 5.92) and performs descriptive analysis.
6. python 02_Code/Model_Analysis/robustness_checks.py
7. python 02_Code/Model_Analysis/create_balance_table_sample.py

PHASE 3: FIGURE GENERATION
8.  Rscript 02_Code/Figure_Generation/plot_map.R
9.  Rscript 02_Code/Figure_Generation/plot_deprivation.R
10. Rscript 02_Code/Figure_Generation/plot_event_study.R
11. Rscript 02_Code/Figure_Generation/plot_energy_timeline.R
12. Rscript 02_Code/Figure_Generation/plot_mechanism.R

CONTACT
-------
For questions regarding data access, please contact the corresponding author.